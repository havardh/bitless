%Should contain: Ringbuffer, Switch buffer, input/output buffers, constant memory, inst memory, read and write lines to the fpga from the ARM. Originally the ARM only needed access to the first and the last data buffer but for debugging purposes the ARM was given access to all buffers.
\subsection{Memory types}\label{subsec:fpga-memory}

The internal block RAMs in the FPGA were used to implement the different kinds
of memory inside the processor. Even though this is limited by the amount of
memory available, it guarantees equal access time for all the different types
of memory. It also precludes having to use external RAM, which would not be as
fast, besides consuming more energy, making the project less energy-efficient.

\subsubsection{Instruction memory}
Each processor core has a separate instruction memory. This memory is filled
with instructions defining the program the processor core will run. Before the
FPGA processor cores get set to run, the the MCU writes the programs for each
core into these instruction memories.

\subsubsection{Audio Pipeline Buffers}
The audio pipeline buffers are used for inter-core communication. These memory
modules are shared between two processing cores, except for the outermost cores
in the pipeline, where they are the input and output for the audio pipeline. The
memory modules can operate as ringbuffers or switching buffers. While the audio
pipeline's input/output memory modules can only be operated as ringbuffers,
while the rest of the memory modules might be operated in either manner.

Since the BRAM modules in the fpga only feature two in/out ports, only the
first input and last output data memories are avaliable for the MCU to
write/read.

Independently of the buffer mode, the previous processor in the audio pipeline
has read and write access to the shared memory module, while the next core has
read-only access.

Memory modules communication data samples representing values in the frequency
domain are operated as switching buffers. While miscellaneous samples and
samples from the time domain stored in memory modules which are operated a
ringbuffer. These memory modules rotate the ringbuffer one slot per new sample.
Half of ringbuffer memory is readable by the next processor in the audio
pipeline, while the previous one can read and write to the whole memory.
Standard behaviour is to write only to the upper half, in order to prevent a
Write After Read (WAR) and similar hazards.

Data stored in the frequency domain uses every available memory address, and as
such the next processor in the audio pipeline has to gain access to all recent
values. For this reason, memory modules holding frequency values have a
switching mode, where the two processor cores switch base address at each
sample's arrival.

\subsubsection{Constant memory}
The constant memory is used to store constants needed for the SD-FT transforms
in each audio pipeline. While this memory is read-only, each audio pipeline
contains its own constant memory, and this memory can only be accessed by two
audio pipeline processor cores simultaneously. It is the pipeline control
register, which is configured by the MCU, which decides which cores can access
the constant memory.

The reason why only two cores are permitted access to the constant memory, is
that the internal block RAMs in the FPGA only have have two independent
read ports, permitting a maximum of two simultaneous reads. If more processors
were to have access to the constant memories an arbitration unit would be
needed, and the advantage of using the block RAM to ensure sincle-cycle access
time would be lost.
