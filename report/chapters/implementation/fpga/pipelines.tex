\FloatBarrier
\subsection{Audio Pipelines}\label{sec:audio_pipelines}

\missingfigure{Overview of the pipeline structure, preferably use the same
picture as in assignment.tex line 38. But in this one, specify the filters/
effects so that they match what we're running in the demo. Instead of all of them
saying ``could be this or that''.}

The two aforementioned core-pipelines consist of a series of processors
connected by buffers. The buffers operate either as ringbuffers or as buffers
switching between two sets of data.
Figure \ref{fig:pipeline_overview}\todo{fix reference} illustrates the
layout of the pipelines.

\subsubsection{Start-up}\label{subsection:fpga-pipeline-startup}
\todo{This does not belong here, remove or move to the software chapter}

\todo[inline]{This is where we explain how the MCU sets up the pipeline, and
how/what signals are set (and to what they are set) when the processor starts
up.}

When starting up, the first thing that has to happen when attempting to
initialize the FPGA-chip, is to use the EBI-bus to write to reset bit (the 15th
(MSB)), should be used when initializing the FPGA in the toplevel
FPGA-control register (which is described in section
\ref{subsection:fpga-design-toplevel}).

This then resets \todo{Resets what in the FPGA??}.

After the reset has been accomplished, the reset bit in the toplevel
FPGA-control register needs to be cleared again. The following step will then be
to turn on the ``stopmode'' bit (the 7th bit) of the pipeline-control
register (as described in section \ref{subsection:fpga-pipeline-startup}),
to stop all of the processor cores on the FPGA.

While all the processor cores are off, the instruction memory of each core needs
to be filled with the instructions said core will run via the EBI-bus. Before
the stopmode bit is cleared and the cores are set to run, the first datasamples
should be prepared and in position with the help of the EBI bus into the input
buffers on each pipeline.

Then what remains is the final stage of turning the stopmode bit back on, and
the FPGA should be running as programmed.

